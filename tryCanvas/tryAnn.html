<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
		<script type="text/javascript" src="js/jCanvaScript.1.5.18.js" ></script>
		<script type="text/javascript" src="js/dicomViewer.js" ></script>
		<style>
			canvas{
				background-color: #000000;
			}
			
			canvas.selected{
				background-color: #000000;
			    border: red;
    			border-style: solid;
   	 			border-width: thin;
			}
			.toolbarGroup input{
				width: 60px;
			}
		</style>
		<script>
			window.onload = function(){
				var serializedString = undefined;
				
			    var dcmFile = {};
		        dcmFile.dicomTags = JSON.parse('[{"group":16,"element":16,"value":"asdf^asdf^"},{"group":16,"element":32,"value":"PAT000001"},{"group":16,"element":64,"value":""},{"group":16,"element":48,"value":""},{"group":40,"element":4177,"value":"2696"},{"group":40,"element":4176,"value":"2048"},{"group":8,"element":48,"value":"123237"},{"group":8,"element":32,"value":"20170525"},{"group":24,"element":20737,"value":"AP"},{"group":24,"element":21,"value":"ELBOW"}]');
			    dcmFile.imgWidth =  2868;
			    dcmFile.imgHeight =  3460;
			    dcmFile.windowWidth = 2696;
			    dcmFile.windowCenter = 2048;
			    dcmFile.id = 1;
				
				var imgDataUrl = 'http://localhost/jpacs' + "/Image/GetJPGImageData/{0}".format(dcmFile.id);
    			dcmFile.imgDataUrl = imgDataUrl;
				
				var v1 = new dicomViewer('c1');
			    v1.load(dcmFile, function () {
			        console.log('success load image!');
			
			        var tagList = dcmFile.dicomTags;
			        //v1.setDicomTags(tagList);
			        v1.addOverlay(dicomTag.patientName, overlayPos.topLeft1);
			        v1.addOverlay(dicomTag.patientBirthDate, overlayPos.topLeft2, 'Birth');
			        v1.addOverlay(dicomTag.patientSex, overlayPos.topLeft3, 'Sex');
			        v1.addOverlay(dicomTag.patientID, overlayPos.topLeft4, 'ID');
			        v1.addOverlay(dicomTag.studyDate, overlayPos.topRight1, 'Date');
			        v1.addOverlay(dicomTag.studyTime, overlayPos.topRight2, 'Time');
			        v1.addOverlay(dicomTag.bodyPart, overlayPos.bottomLeft1);
			        v1.addOverlay(dicomTag.viewPosition, overlayPos.bottomLeft2);
			        v1.addOverlay(dicomTag.windowWidth, overlayPos.bottomLeft3, "W");
			        v1.addOverlay(dicomTag.windowCenter, overlayPos.bottomLeft4, "L");
			        v1.addOverlay(dicomTag.customScale, overlayPos.bottomRight1, "Scale");
			    });
			    

			    
			    var v2 = new dicomViewer('c2');
 				v2.load(dcmFile, function () {
			        console.log('success load image!');
			
			        var tagList = dcmFile.dicomTags;
			        //v1.setDicomTags(tagList);
			        v1.addOverlay(dicomTag.patientName, overlayPos.topLeft1);
			        v1.addOverlay(dicomTag.patientBirthDate, overlayPos.topLeft2, 'Birth');
			        v1.addOverlay(dicomTag.patientSex, overlayPos.topLeft3, 'Sex');
			        v1.addOverlay(dicomTag.patientID, overlayPos.topLeft4, 'ID');
			        v1.addOverlay(dicomTag.studyDate, overlayPos.topRight1, 'Date');
			        v1.addOverlay(dicomTag.studyTime, overlayPos.topRight2, 'Time');
			        v1.addOverlay(dicomTag.bodyPart, overlayPos.bottomLeft1);
			        v1.addOverlay(dicomTag.viewPosition, overlayPos.bottomLeft2);
			        v1.addOverlay(dicomTag.windowWidth, overlayPos.bottomLeft3, "W");
			        v1.addOverlay(dicomTag.windowCenter, overlayPos.bottomLeft4, "L");
			        v1.addOverlay(dicomTag.customScale, overlayPos.bottomRight1, "Scale");
			    });
			    
				var curViewer = v1;
				$('#c1').on('click', function(){
					$('#c1').addClass('selected');
					$('#c2').removeClass('selected');
					
					curViewer = v1;
				});
				
				$('#c2').on('click', function(){
					$('#c2').addClass('selected');
					$('#c1').removeClass('selected');
					
					curViewer = v2;
				})
			
				$('#btnAddLine').on('click', function(){
					var aLine = curViewer.createLine();
				});
				
				$('#btnAddRect').on('click', function(){
					var aRect = curViewer.createRect();
				});
				
				$('#btnSelect').on('click', function(){
					curViewer.setSelectModel();
				});
				
				$('#btnPan').on('click', function(){
					curViewer.setPanModel();
				});
				
				$('#btnRotate').on('click', function(){
					curViewer.rotate(30);
				});
				$('#btnWL').on('click', function(){
					curViewer.setWLModel();
				});
				$('#btnReset').on('click', function(){
					curViewer.reset();
				});
				
				$('#btnDelete').on('click', function(){
					var curObj = curViewer.curSelectObj;
					if(curObj){
						curViewer.deleteObject(curObj);
					}
				});
				
				$('#btnSave').on('click', function(){
					serializedString = curViewer.serialize();
					alert(serializedString);
				});
				
				$('#btnLoad').on('click', function(){
					if(serializedString){
						curViewer.deSerialize(serializedString);
					}
				});
								
				$('#btnBestFit').on('click', function(){
					curViewer.bestFit();
				});
				
			}
		</script>
	</head>
	<body>
		<div>
			<table class='toolbarGroup'>
				<tr>
					<td><input id='btnSelect' type="button" value='Select'></td>
					<td><input id='btnPan' type="button" value='Pan'></td>
					<td><input id='btnWL' type="button" value='W/L'></td>
					<td><input id='btnRotate' type="button" value='Rotate'></td>
					<td><input id='btnReset' type="button" value='True Size' style="width:75px"></td>
					<td><input id='btnBestFit' type="button" value='Best Fit'></td>
					<td><input id='btnAddRect' type="button" value='Rect'></td>
					<td><input id='btnAddLine' type="button" value='Line'></td>
					<td><input id='btnDelete' type="button" value='Delete'></td>
					<td><input id='btnSave' type="button" value='Save'></td>
				</tr>
			</table>
		</div>
		<div>
			<canvas id='c1' width="800" height="500" class='selected' tabindex="1"></canvas>
			<canvas id='c2' width="800" height="500" tabindex="2"></canvas>
		</div>
	</body>
</html>
